{"version":3,"file":"VormiaClient.js","sources":["../../../src/core/VormiaClient.js"],"sourcesContent":["import axios from \"axios\";\n\n/* global process */\n\n// Environment variable fallbacks\nconst DEFAULT_CONFIG = {\n  VORMIA_API_URL: process.env.VORMIA_API_URL || \"\",\n  VORMIA_AUTH_TOKEN_KEY: process.env.VORMIA_AUTH_TOKEN_KEY || \"auth_token\",\n  VORMIA_TIMEOUT: process.env.VORMIA_TIMEOUT\n    ? parseInt(process.env.VORMIA_TIMEOUT, 10)\n    : 30000,\n  VORMIA_WITH_CREDENTIALS:\n    process.env.VORMIA_WITH_CREDENTIALS === \"true\" || false,\n};\n\nexport class VormiaError extends Error {\n  constructor(message, status, response, code) {\n    super(message);\n    this.name = \"VormiaError\";\n    this.status = status;\n    this.response = response;\n    this.code = code;\n  }\n}\n\nexport class VormiaClient {\n  constructor(config = {}) {\n    // Start with default config from environment variables\n    const defaultConfig = {\n      baseURL: DEFAULT_CONFIG.VORMIA_API_URL || \"\",\n      authTokenKey: DEFAULT_CONFIG.VORMIA_AUTH_TOKEN_KEY,\n      withCredentials: DEFAULT_CONFIG.VORMIA_WITH_CREDENTIALS,\n      timeout: DEFAULT_CONFIG.VORMIA_TIMEOUT,\n    };\n\n    // Merge with user-provided config (user config takes precedence)\n    this.config = { ...defaultConfig, ...config };\n\n    // Validate required configuration\n    if (!this.config.baseURL) {\n      console.warn(\n        \"VormiaClient: No baseURL provided. Please set VORMIA_API_URL in your .env file or pass baseURL in the config.\"\n      );\n    }\n\n    // Create axios instance\n    this.axiosInstance = axios.create({\n      baseURL: this.config.baseURL,\n      timeout: this.config.timeout,\n      headers: {\n        \"Content-Type\": \"application/json\",\n        ...this.config.headers,\n      },\n      withCredentials: this.config.withCredentials,\n    });\n\n    this.setupInterceptors();\n  }\n\n  setupInterceptors() {\n    // Request interceptor\n    this.axiosInstance.interceptors.request.use(\n      (config) => {\n        // Add auth token if available\n        const token = this.getAuthToken();\n        if (token) {\n          config.headers.Authorization = `Bearer ${token}`;\n        }\n        return config;\n      },\n      (error) => Promise.reject(error)\n    );\n\n    // Response interceptor\n    this.axiosInstance.interceptors.response.use(\n      (response) => response,\n      (error) => {\n        if (error.response && error.response.status === 401) {\n          // Handle unauthorized\n          if (this.config.onUnauthenticated) {\n            this.config.onUnauthenticated();\n          }\n        }\n        return Promise.reject(error);\n      }\n    );\n  }\n\n  // Core HTTP methods\n  async request(config) {\n    try {\n      const response = await this.axiosInstance.request(config);\n      return response;\n    } catch (error) {\n      const status = error.response?.status;\n      const response = error.response?.data;\n      const message = error.message || \"Request failed\";\n      throw new VormiaError(message, status, response, error.code);\n    }\n  }\n\n  get(url, config) {\n    return this.request({ ...config, method: \"GET\", url });\n  }\n\n  post(url, data, config) {\n    return this.request({ ...config, method: \"POST\", url, data });\n  }\n\n  put(url, data, config) {\n    return this.request({ ...config, method: \"PUT\", url, data });\n  }\n\n  delete(url, config) {\n    return this.request({ ...config, method: \"DELETE\", url });\n  }\n\n  patch(url, data, config) {\n    return this.request({ ...config, method: \"PATCH\", url, data });\n  }\n\n  // Auth methods\n  setAuthToken(token) {\n    if (typeof window !== \"undefined\") {\n      localStorage.setItem(this.config.authTokenKey, token);\n    }\n  }\n\n  clearAuthToken() {\n    if (typeof window !== \"undefined\") {\n      localStorage.removeItem(this.config.authTokenKey);\n    }\n  }\n\n  getAuthToken() {\n    if (typeof window !== \"undefined\") {\n      return localStorage.getItem(this.config.authTokenKey);\n    }\n    return null;\n  }\n}\n\n// Global instance management\nlet globalClient = null;\n\nexport function createVormiaClient(config) {\n  globalClient = new VormiaClient(config);\n  return globalClient;\n}\n\nexport function getGlobalVormiaClient() {\n  if (!globalClient) {\n    throw new Error(\n      \"VormiaClient has not been initialized. Call createVormiaClient first.\"\n    );\n  }\n  return globalClient;\n}\n\nexport function setGlobalVormiaClient(client) {\n  globalClient = client;\n}\n"],"names":["DEFAULT_CONFIG","VORMIA_API_URL","process","env","VORMIA_AUTH_TOKEN_KEY","VORMIA_TIMEOUT","parseInt","VORMIA_WITH_CREDENTIALS","VormiaError","Error","constructor","message","status","response","code","super","this","name","VormiaClient","config","defaultConfig","baseURL","authTokenKey","withCredentials","timeout","console","warn","axiosInstance","axios","create","headers","setupInterceptors","interceptors","request","use","token","getAuthToken","Authorization","error","Promise","reject","onUnauthenticated","_a","_b","data","get","url","method","post","put","patch","setAuthToken","window","localStorage","setItem","clearAuthToken","removeItem","getItem","globalClient","client"],"mappings":"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"}